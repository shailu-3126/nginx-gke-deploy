server {
  listen 80;
  root /usr/share/nginx/html;
  index index.html;

  # Serve React app (SPA) â€” try file then fall back to index.html
  location / {
    try_files $uri $uri/ /index.html;
  }

  # Proxy /api1/* -> backend1:8000/*
  location ^~ /api1/ {
    rewrite ^/api1(/.*)$ $1 break;
    proxy_pass http://backend1:8000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_http_version 1.1;
    proxy_set_header Connection "";
  }

  # Proxy /api2/* -> backend2:8000/*
  location ^~ /api2/ {
    rewrite ^/api2(/.*)$ $1 break;
    proxy_pass http://backend2:8000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_http_version 1.1;
    proxy_set_header Connection "";
  }

  # Proxy /api3/* -> backend3:8000/*
  location ^~ /api3/ {
    rewrite ^/api3(/.*)$ $1 break;
    proxy_pass http://backend3:8000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_http_version 1.1;
    proxy_set_header Connection "";
  }

  gzip on;
}
